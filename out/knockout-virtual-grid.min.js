define("text!src/knockout-virtual-grid.html",[],function(){return'<table class="vg-t" data-bind="css: tableCss">\n    <thead></thead>\n    <tbody>\n        <!-- ko foreach: virtualGridRow -->\n        <tr class="vg-r" data-bind="css: rowCss">\n            <!-- ko foreach: $data.fixedColumns -->\n            <td class="vg-c vg-f" data-bind="css: css, html: value"></td>\n            <!-- /ko -->\n\n            <!-- ko if: $data.editable -->\n            <!-- ko foreach: $data.columns -->\n            <td class="vg-c" data-bind="css: css, editableCell: value, cellHTML: $parent.format(underlyingValue()), cellReadOnly: readonly"></td>\n            <!-- /ko -->\n            <!-- /ko -->\n            <!-- ko ifnot: $data.editable -->\n            <!-- ko foreach: $data.columns -->\n            <td class="vg-c" data-bind="css: css, html: $parent.format(value())"></td>\n            <!-- /ko -->\n            <!-- /ko -->\n        </tr>\n        <!-- /ko -->\n    </tbody>\n    <tfoot>\n    </tfoot>\n</table>\n'}),define("src/knockout-virtual-grid",["require","exports","knockout","text!./knockout-virtual-grid.html"],function(t,o,n){o.template=t("text!./knockout-virtual-grid.html");var e=function(){function t(t){var o=this;if(console.log("[KnockoutVirtualGrid] %o",t),!t||!t.dataSource)throw new Error("Invalid params");this.tableCss=n.observable(t.css||""),this.dataSource=t.dataSource,this.onEdit=t.onEdit||this.handleOnEdit,this.onAfterEdit=t.onAfterEdit||this.handleOnAfterEdit;var e=t.dataSource(),a=this.measure(e);this.layout=new s(a.maxRows,a.maxColumns,t.offset,t.layout);var r=this.initialize(e);this.virtualGridRow=n.observableArray([]).extend({rateLimit:0}),this.virtualGridRow(r),this.render(),this.subscriptions=[this.layout.changed.subscribe(function(){return o.render()}),this.dataSource.subscribe(function(t){return o.onNewData(t)})]}return t.prototype.handleOnEdit=function(){return console.debug("[VG] base.handleOnEdit"),!0},t.prototype.handleOnAfterEdit=function(){console.debug("[VG] base.handleOnAfterEdit")},t.prototype.onNewData=function(t){console.log("[VG] onNewData...");var o=this.measure(t);o.maxRows<this.layout.rows()||o.maxColumns<this.layout.columns()?(console.log("[VG] re-initializing"),this.layout.maxRows=o.maxRows,this.layout.maxColumns=o.maxColumns,this.render()):(this.layout.maxRows=o.maxRows,this.layout.maxColumns=o.maxColumns,this.render())},t.prototype.measure=function(t){var o={maxRows:0,maxColumns:0};return t&&t.length>0&&(o.maxRows=t.length,t[0].columns&&t[0].columns.length>0&&(o.maxColumns=t[0].columns.length)),console.log("[VG] initialize: %o",o),o},t.prototype.initialize=function(t){if(!t||0===t.length)return[];var o,e,s,a=[],r=Math.min(t.length,this.layout.rows()),i=Math.min(t[0].columns.length,this.layout.columns()),l=Math.min(this.layout.column(),r),u=Math.min(this.layout.row(),i);console.log("[VG] convert: max rows: %d, max cols: %d, i: %d, j: %d",r,i,l,u);for(var d=l;r>d;d++){o=t[d],s=[];for(var c=u;i>c;c++)e=o.columns[c],s.push(this.getColumn(e.value,d,c,e.css));a.push({rowIndex:d,columns:n.observableArray(s),rowCss:n.observable(o.css&&o.css.length>0?o.css.join(" "):""),fixedColumns:n.observableArray([]),format:function(t){return t.toString()},editable:n.observable(!0)})}return console.log("[VG] convert - rows: %d",a.length),a},t.prototype.getColumn=function(t,o,e,s){var a=this,r=n.observable(t),i={columnIndex:e,rowIndex:o,underlyingValue:r,value:n.computed({read:function(){return i.underlyingValue()},write:function(t){var o=i.underlyingValue.peek();if(t!==o){var n=arguments.length>1?arguments[1]:void 0,e=n?n.cell:void 0,s={metadata:i.metadata,rowIndex:i.rowIndex,columnIndex:i.columnIndex},r=!1;try{r=a.onEdit(t,s),r&&i.underlyingValue(t)}catch(l){}var u={didEdit:r,previous:o,value:t};a.onAfterEdit(u,s,e)}},deferEvaluation:!0,pure:!0,owner:this}).extend({rateLimit:0}),css:n.observable(s&&s.length>0?s.join(" "):""),readonly:n.observable(!1),metadata:{}};return i},t.prototype.render=function(){var t=this.dataSource.peek(),o=this.virtualGridRow.peek();if(t&&0!==t.length){var n={row:this.layout.row(),column:this.layout.column()},e={row:Math.min(n.row,this.layout.maxRows-this.layout.rows()),column:Math.min(n.column,this.layout.maxColumns-this.layout.columns())},s={row:Math.min(e.row+this.layout.rows(),this.layout.maxRows),column:Math.min(e.column+this.layout.columns(),this.layout.maxColumns)};console.log("[VG] render: source: [%d, %d ], start: %o, end: %o",t.length,t[0].columns.length,e,s);for(var a=0,r=e.row;r<s.row;r++,a++){var i=t[r],l=o[a],u=l.columns();l.rowCss(i.css&&i.css.length>0?i.css.join(" "):"");for(var d=0,c=e.column;c<s.column;c++,d++){var h=i.columns[c],m=u[d];m.underlyingValue(h.value),m.css(h.css&&h.css.length>0?h.css.join(" "):"")}}}},t.prototype.dispose=function(){for(var t=0;t<this.subscriptions.length;t++){var o=this.subscriptions[t];o&&o.dispose&&o.dispose()}this.layout.dispose()},t}();o.viewModel=e;var s=function(){function t(t,o,e,s){var a=this;this.maxRows=t,this.maxColumns=o;var r,i=[];i.push(e&&e.row?e.row:n.observable(0)),i.push(e&&e.column?e.column:n.observable(0)),s&&s.rows?i.push(s.rows):(r=Math.min(25,this.maxRows),i.push(n.observable(r))),s&&s.columns?i.push(s.columns):(r=Math.min(35,this.maxColumns),i.push(n.observable(r))),this.row=n.computed({read:function(){var t=i[0],o=t();return console.log("[VG] layout - row: %d",o),o},write:function(t){var o=a.maxRows-a.rows();i[0](0>t||isNaN(t)?0:t>=0&&o+1>t?t:o)},deferEvaluation:!0,owner:this}).extend({rateLimit:0}),this.column=n.computed({read:function(){return i[1]()},write:function(t){var o=a.maxColumns-a.columns();i[1](0>t||isNaN(t)?0:t>=0&&o+1>t?t:o)},deferEvaluation:!0,owner:this}).extend({rateLimit:0}),this.rows=n.computed({read:function(){return i[2]()},deferEvaluation:!0,owner:this}).extend({rateLimit:0}),this.columns=n.computed({read:function(){return i[3]()},deferEvaluation:!0,owner:this}).extend({rateLimit:0}),this.changed=n.computed({read:function(){return[a.row(),a.column(),a.rows(),a.columns()]},owner:this,pure:!0,deferEvaluation:!0}).extend({rateLimit:0})}return t.prototype.dispose=function(){this.row.dispose(),this.column.dispose(),this.rows.dispose(),this.columns.dispose(),this.changed.dispose()},t}();o.LayoutOffsetHelper=s});